# ccg-transact-api
Endpoint for storing ACH or Credit Card transactions in MSSQL DB


## Deployment Guide

This guide outlines the steps required to deploy the application behind an Nginx reverse proxy on an Ubuntu server, secured with a Let's Encrypt SSL certificate.

### Prerequisites

- An Ubuntu 18.04 or later server with root access
- A registered domain name pointing to your server

### Steps

1. **Install Node.js**

First, you will need to install Node.js on your Ubuntu server. You can do this with the following commands:

```bash
curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -
sudo apt-get install -y nodejs

# Ubuntu 22.04
sudo apt install -y nodejs
```

2. **Clone the application**

Next, clone your application to your server:

```bash
git clone <your repo url>
cd <your repo directory>
npm install
```

3. **Install PM2**

PM2 is a process manager for Node.js applications. It will manage and keep your application online, even in the event of a crash.

```bash
npm install pm2 -g
```

Start your application with PM2:

```bash
pm2 start server.js
```

To ensure your application restarts on server reboot, you can use the startup script generated by:

```bash
pm2 startup
```

Then follow the instruction to run the generated command.

4. **Install Nginx**

Install Nginx using Ubuntu's package manager:

```bash
sudo apt-get update
sudo apt-get install nginx
```

5. **Configure Nginx**

Now you will configure Nginx to reverse proxy to your application. Open a new Nginx configuration file in a text editor:

```bash
sudo nano /etc/nginx/sites-available/myapp
```

And add the following configuration:

```nginx
server {
    listen 80;
    server_name yourdomain.com;

    location / {
        proxy_pass http://localhost:3000; # change to the port your app runs on
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

Replace `yourdomain.com` with your domain name, and make sure the `proxy_pass` directive points to the port your app is running on.

Save and exit the text editor. Enable the new configuration by creating a symlink to the `sites-enabled` directory:

```bash
sudo ln -s /etc/nginx/sites-available/myapp /etc/nginx/sites-enabled/
```

6. **Install Certbot**

Certbot is a tool that automates getting and installing SSL certificates with Let's Encrypt. You can install it with the following commands:

```bash
sudo apt-get install software-properties-common
sudo add-apt-repository universe
sudo add-apt-repository ppa:certbot/certbot
sudo apt-get update
sudo apt-get install certbot python-certbot-nginx 
```

7. **Configure SSL**

Finally, you can configure SSL for your domain with the following command:

```bash
sudo certbot --nginx -d yourdomain.com
```

Replace `yourdomain.com` with your domain name. Follow the on-screen prompts, and certbot will automatically configure Nginx to use SSL with your new certificate.

Sure, here's a suggestion for that section in your README:

---

## API Key Authentication

This API uses API keys for authentication. The keys are stored in a `keys.json` file in the following format:

```json
{
  "keys": [
    "key1",
    "key2",
    // more keys...
  ]
}
```

Each request must include a valid API key in the `x-api-key` header or as an `x-api-key` query string parameter.

Example:

```
POST /api/transactions/[creditcard|ach]?x-api-key=your-api-key
```

Or in the request header:

```
x-api-key: your-api-key
```

### Generating API Keys

API keys can be generated using the included utility script. To generate a new API key, use the following command:

```bash
npm run generate-key
```

This will generate a new, 32-character long API key and print it out. Copy the generated key and add it to your `keys.json` file.

Remember to treat these keys as sensitive data, and be careful not to expose them publicly.
